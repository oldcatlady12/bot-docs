<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Schedules Bot - Documentation</title>
    <style>
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a1f2e;
            --bg-card: #1e2433;
            --text-primary: #e7e9ea;
            --text-secondary: #8b98a5;
            --accent-blue: #1d9bf0;
            --accent-green: #00ba7c;
            --accent-purple: #7856ff;
            --accent-orange: #ff7a00;
            --accent-gold: #ffd700;
            --border-color: #2f3542;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
        header { background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); padding: 20px 0; position: sticky; top: 0; z-index: 100; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .back-link { color: var(--accent-blue); text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .bot-icon { width: 48px; height: 48px; background: linear-gradient(135deg, #7856ff, #ff7a00); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        main { padding: 40px 0; }
        .content-section { margin-bottom: 48px; }
        .content-section h2 { font-size: 1.75rem; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color); }
        .content-section h3 { font-size: 1.25rem; margin: 24px 0 12px; color: var(--accent-blue); }
        .content-section p { color: var(--text-secondary); margin-bottom: 16px; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 16px; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .feature-item { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; }
        .feature-icon { font-size: 24px; margin-bottom: 8px; }
        .feature-item h4 { margin-bottom: 4px; }
        .feature-item p { color: var(--text-secondary); font-size: 0.9rem; margin: 0; }
        .command-table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
        .command-table th, .command-table td { text-align: left; padding: 12px 16px; border-bottom: 1px solid var(--border-color); }
        .command-table th { background: var(--bg-secondary); color: var(--text-secondary); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; }
        .command-name { font-family: 'Consolas', monospace; background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; color: var(--accent-blue); }
        .code-block { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; font-family: 'Consolas', monospace; font-size: 0.9rem; overflow-x: auto; margin-bottom: 16px; }
        .tag { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; margin-right: 6px; }
        .tag.user { background: rgba(0, 186, 124, 0.2); color: var(--accent-green); }
        .tag.admin { background: rgba(255, 122, 0, 0.2); color: #ff7a00; }
        .tag.new { background: rgba(255, 215, 0, 0.2); color: var(--accent-gold); }
        ul { margin-left: 24px; margin-bottom: 16px; color: var(--text-secondary); }
        li { margin-bottom: 8px; }
        .integration-card { background: linear-gradient(135deg, rgba(29, 155, 240, 0.1), rgba(120, 86, 255, 0.1)); border: 1px solid var(--accent-blue); }
        .highlight { color: var(--accent-gold); font-weight: 600; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="back-link"><span>&larr;</span> Back to All Bots</a>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="bot-icon">&#128197;</div>
                    <h1>Sports Schedules Bot</h1>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <section class="content-section">
                <h2>Overview</h2>
                <p>The Sports Schedules Bot posts a single schedule message per channel with direct links to active game posts created by the Sports Bot. It automatically updates when the Sports Bot creates or removes game posts, and includes a <span class="highlight">Game Results dropdown</span> that connects to the AI vs Humans Bot for viewing prediction outcomes.</p>

                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="feature-icon">&#128197;</div>
                        <h4>Live Schedules</h4>
                        <p>Real-time game schedules grouped by sport with Discord timestamps</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128260;</div>
                        <h4>Auto Updates</h4>
                        <p>Watches Sports Bot settings file and updates on any change</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128279;</div>
                        <h4>Game Post Links</h4>
                        <p>Direct channel mentions to forum game threads</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128200;</div>
                        <h4>Game Results</h4>
                        <p>Dropdown to view AI vs Human prediction outcomes per game</p>
                    </div>
                </div>
            </section>

            <section class="content-section">
                <h2>Schedule Message Format</h2>

                <div class="card">
                    <h4>Active Games Display</h4>
                    <p>The schedule message groups games by sport and shows different formats based on game state:</p>
                    <ul>
                        <li><strong>Pre-Game:</strong> <code>&#8226; <b>AWAY</b> @ <b>HOME</b> &#8226; starts in 2 hours &#8226; #game-thread</code></li>
                        <li><strong>Live Game:</strong> <code>&#8226; &#128308; <b>AWAY</b> @ <b>HOME</b> &#8226; LIVE - 3rd Quarter &#8226; #game-thread</code></li>
                        <li><strong>No Active Games:</strong> Shows "No active games at the moment" with a note that all games have finished or no posts have been created yet</li>
                    </ul>
                    <p>Finished games (state = "post") are automatically excluded from the schedule. The message footer reads "Updates automatically &#8226; Refresh button for instant update".</p>
                </div>

                <h3>Sports Ordering</h3>
                <div class="card">
                    <p>Games are grouped and ordered by sport in this order:</p>
                    <ul>
                        <li>&#127944; NFL</li>
                        <li>&#127891; College Football (CFB)</li>
                        <li>&#127936; NBA</li>
                        <li>&#127936; WNBA</li>
                        <li>&#9918; MLB</li>
                        <li>&#127936; NCAA Men's Basketball</li>
                        <li>&#127936; NCAA Women's Basketball</li>
                    </ul>
                </div>
            </section>

            <section class="content-section">
                <h2>Bot Integration</h2>

                <h3>Sports Bot Integration</h3>
                <div class="card">
                    <p>Works alongside the Sports Bot by reading its <code>bot_settings.json</code> file:</p>
                    <ul>
                        <li><strong>game_threads:</strong> Maps game IDs to forum thread IDs for channel mentions</li>
                        <li><strong>team_roles:</strong> Maps team names to Discord role IDs</li>
                        <li><strong>sport_forums:</strong> Maps sport keys to forum channel IDs</li>
                        <li><strong>enabled_sports:</strong> List of sports enabled per guild</li>
                    </ul>
                    <p>The bot detects changes by monitoring the settings file modification time every 3 seconds. When any change is detected, the schedule is immediately updated regardless of whether games were added or removed.</p>
                </div>

                <h3>AI vs Humans Bot Integration</h3>
                <div class="card integration-card">
                    <p>Connects read-only to the AI vs Humans Bot SQLite database (<code>ai_vs_humans.db</code>) to display game results:</p>
                    <ul>
                        <li><strong>Results Dropdown:</strong> Select from up to 25 recent completed games</li>
                        <li><strong>Final Scores:</strong> Game outcomes with winner indicator (&#127942;) and total points vs O/U line</li>
                        <li><strong>AI Predictions:</strong> Each AI model's winner/O/U picks with &#9989;/&#10060; correctness indicators and confidence %</li>
                        <li><strong>Human Stats:</strong> Total predictions, pick distribution (home/away, over/under), and accuracy rates</li>
                        <li><strong>AI vs Humans:</strong> Overall accuracy comparison to determine who won the prediction battle</li>
                    </ul>
                    <p>If the AI vs Humans database is not found at startup, the results feature is disabled and a warning is logged. The bot checks database availability before any results operation.</p>
                </div>
            </section>

            <section class="content-section">
                <h2>Commands</h2>

                <h3>Schedule Commands <span class="tag admin">Admin Only</span></h3>
                <table class="command-table">
                    <thead><tr><th>Command</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr>
                            <td><span class="command-name">!schedule_set_channel #channel</span></td>
                            <td>Set the channel for schedule messages. If no channel is mentioned, uses the current channel. Saves the channel ID to bot settings and confirms with the update interval.</td>
                        </tr>
                        <tr>
                            <td><span class="command-name">!schedule_post [#channel]</span></td>
                            <td>Post a new schedule message to the specified channel (or current channel if omitted). Builds the schedule embed with all active game posts grouped by sport, attaches the Refresh button, saves the message to the database for tracking, and starts the auto-update cycle.</td>
                        </tr>
                        <tr>
                            <td><span class="command-name">!schedule_refresh</span></td>
                            <td>Manually refresh the existing tracked schedule message with the latest game data and restart the auto-update cycle. If no schedule message exists, prompts to use <code>!schedule_post</code> first.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Results Commands <span class="tag admin">Admin Only</span></h3>
                <table class="command-table">
                    <thead><tr><th>Command</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr>
                            <td><span class="command-name">!schedule_post_results [#channel]</span></td>
                            <td>Post the game results dropdown message to the specified channel (or current). Displays a menu embed with a dropdown of up to 25 recent completed games and a Refresh Results button. Requires the AI vs Humans database to be available.</td>
                        </tr>
                        <tr>
                            <td><span class="command-name">!schedule_post_all [#channel]</span></td>
                            <td>Post both the schedule message and the results dropdown message together in the specified channel. Posts the schedule first, then the results. Starts auto-updates and reports success/failure for each message independently.</td>
                        </tr>
                        <tr>
                            <td><span class="command-name">!schedule_refresh_results</span></td>
                            <td>Manually refresh the existing results dropdown message with the latest completed games from the AI vs Humans database. If no results message exists, prompts to use <code>!schedule_post_results</code> first.</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Utility Commands</h3>
                <table class="command-table">
                    <thead><tr><th>Command</th><th>Description</th><th>Permission</th></tr></thead>
                    <tbody>
                        <tr>
                            <td><span class="command-name">!schedule_status</span></td>
                            <td>Shows a status embed with: active game post count, schedule channel, auto-update state (active/waiting), last schedule update timestamp, results feature availability (database found + message posted), background task statuses (settings watcher and schedule updater), and list of enabled sports with emojis.</td>
                            <td><span class="tag admin">Admin</span></td>
                        </tr>
                        <tr>
                            <td><span class="command-name">!schedule_debug</span></td>
                            <td>Shows a debug embed with: Sports Bot settings file path and last modification time, current vs tracked game thread counts with IDs, settings watcher and schedule updater running status, and all tracked schedule message IDs per guild.</td>
                            <td><span class="tag admin">Admin</span></td>
                        </tr>
                        <tr>
                            <td><span class="command-name">!schedule_help_schedule</span></td>
                            <td>Shows help information for all users including: Refresh button usage, Game Results dropdown explanation, and auto-update behavior. Admins additionally see a full list of all admin commands.</td>
                            <td><span class="tag user">Everyone</span></td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="content-section">
                <h2>Game Results Feature</h2>

                <div class="card integration-card">
                    <h4>How It Works</h4>
                    <p>The results message displays a dropdown menu with up to 25 recent completed games from the AI vs Humans Bot database:</p>
                    <ul>
                        <li><strong>Step 1:</strong> Select a completed game from the dropdown (shows team abbreviations, scores, sport emoji, and date)</li>
                        <li><strong>Step 2:</strong> View an ephemeral embed (only visible to you) with full results</li>
                        <li><strong>Step 3:</strong> See final score with winner indicator, game date as Discord timestamp, and total points vs O/U line</li>
                        <li><strong>Step 4:</strong> View each AI model's predictions with confidence % and correct/incorrect markers</li>
                        <li><strong>Step 5:</strong> See human prediction totals, pick distribution, and accuracy rates</li>
                        <li><strong>Step 6:</strong> Find out who won the prediction battle: AI or Humans (based on overall accuracy %)</li>
                    </ul>
                </div>

                <h3>Results Display Includes:</h3>
                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="feature-icon">&#127942;</div>
                        <h4>Final Score</h4>
                        <p>Game outcome with winner indicator, Discord timestamp for game date, and total points vs O/U line (OVER/UNDER result)</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#129302;</div>
                        <h4>AI Predictions</h4>
                        <p>Each AI model's winner pick and O/U pick with confidence percentage and &#9989;/&#10060; correctness indicators. Shows X/Y correct in header.</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128101;</div>
                        <h4>Human Stats</h4>
                        <p>Total prediction count, winner pick distribution (home vs away), O/U pick distribution, correct winner count, and correct O/U count</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#9876;</div>
                        <h4>Battle Results</h4>
                        <p>Compares overall AI accuracy vs human accuracy. Declares &#129302; AI Wins, &#128101; Humans Win, or &#129309; Tie with exact percentages</p>
                    </div>
                </div>
            </section>

            <section class="content-section">
                <h2>Auto-Update System</h2>

                <h3>Settings File Watcher</h3>
                <div class="card">
                    <p>The bot monitors the Sports Bot's <code>bot_settings.json</code> file for changes:</p>
                    <ul>
                        <li><strong>Check Interval:</strong> Every 3 seconds</li>
                        <li><strong>Detection Method:</strong> Compares file modification time (<code>os.path.getmtime</code>) against last known value</li>
                        <li><strong>On Change:</strong> Reloads game threads, detects new/removed games, and immediately updates all tracked schedule messages</li>
                        <li><strong>Auto-Start:</strong> When new active game threads are detected, starts the schedule updater loop</li>
                        <li><strong>Always Updates:</strong> Schedule messages are updated on any settings file change, even if no game threads changed (handles edge cases like games finishing)</li>
                    </ul>
                </div>

                <h3>Schedule Updater</h3>
                <div class="card">
                    <p>When games are active, a periodic update loop runs:</p>
                    <ul>
                        <li><strong>Interval:</strong> Every 10 minutes</li>
                        <li><strong>Purpose:</strong> Keeps the schedule message current with game state changes (pre-game &#8594; live &#8594; final)</li>
                        <li><strong>Final Update:</strong> When all games finish, performs one last update to show "No active games" before stopping</li>
                        <li><strong>Auto-Stop:</strong> Cancels itself when no active game threads remain</li>
                        <li><strong>Restart:</strong> Automatically restarted by the settings watcher when new games appear, or manually via <code>!schedule_refresh</code></li>
                    </ul>
                </div>
            </section>

            <section class="content-section">
                <h2>Interactive Elements</h2>

                <h3>Schedule Message</h3>
                <table class="command-table">
                    <thead><tr><th>Element</th><th>Action</th><th>Access</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>&#128260; Refresh Button</td>
                            <td>Immediately rebuilds the schedule embed with latest ESPN game data and channel mentions. Also restarts the auto-update cycle if not already running. Response is ephemeral (only visible to the user who clicked).</td>
                            <td>Everyone</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Results Message</h3>
                <table class="command-table">
                    <thead><tr><th>Element</th><th>Action</th><th>Access</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>&#128203; Game Dropdown</td>
                            <td>Select a completed game to view an ephemeral embed with final score, AI predictions with correctness indicators, human prediction stats, and AI vs Humans battle result. Shows up to 25 recent games with sport emoji, team abbreviations, scores, and date.</td>
                            <td>Everyone</td>
                        </tr>
                        <tr>
                            <td>&#128260; Refresh Results Button</td>
                            <td>Reloads the dropdown with the latest completed games from the AI vs Humans database. Updates both the embed and the dropdown options on the message itself.</td>
                            <td>Everyone</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Persistent Views</h3>
                <div class="card">
                    <p>Both the Schedule and Results views use persistent custom IDs (<code>schedule_refresh_button</code>, <code>game_results_select</code>, <code>results_refresh_button</code>) so buttons and dropdowns continue working after bot restarts. Views are re-registered on startup in the <code>on_ready</code> event.</p>
                </div>
            </section>

            <section class="content-section">
                <h2>Quick Setup</h2>
                <div class="code-block">
# 1. Set the schedule channel
!schedule_set_channel #game-schedules

# 2. Post both schedule and results messages
!schedule_post_all

# 3. Or post them separately:
!schedule_post
!schedule_post_results

# 4. Check bot status
!schedule_status

# 5. View debug info if something isn't working
!schedule_debug
                </div>
            </section>

            <section class="content-section">
                <h2>Background Tasks</h2>
                <table class="command-table">
                    <thead><tr><th>Task</th><th>Interval</th><th>Description</th><th>State</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>Settings Watcher</td>
                            <td>Every 3 seconds</td>
                            <td>Monitors Sports Bot <code>bot_settings.json</code> file modification time. Updates all schedule messages on any change and starts the updater when games appear.</td>
                            <td>Always running</td>
                        </tr>
                        <tr>
                            <td>Schedule Updater</td>
                            <td>Every 10 minutes</td>
                            <td>Periodically updates all tracked schedule messages with latest game states from ESPN. Performs a final update and auto-stops when no games are active.</td>
                            <td>Runs only when games are active</td>
                        </tr>
                    </tbody>
                </table>
            </section>

            <section class="content-section">
                <h2>Error Handling</h2>
                <div class="card">
                    <p>The bot handles common Discord command errors:</p>
                    <ul>
                        <li><strong>Missing Permissions:</strong> Shows "You don't have permission to use this command" for admin-only commands</li>
                        <li><strong>Missing Arguments:</strong> Shows which required argument was missing</li>
                        <li><strong>Bad Arguments:</strong> Reports the invalid argument</li>
                        <li><strong>Unknown Commands:</strong> Silently ignored (only responds to <code>!schedule_</code> prefix commands)</li>
                        <li><strong>Missing Messages:</strong> If a tracked schedule/results message is deleted, removes it from the database on next update attempt</li>
                        <li><strong>Missing Channels:</strong> Logs a warning if the configured channel no longer exists</li>
                    </ul>
                </div>
            </section>

            <section class="content-section">
                <h2>Command Summary</h2>
                <table class="command-table">
                    <thead><tr><th>Category</th><th>Count</th><th>Permission</th></tr></thead>
                    <tbody>
                        <tr><td>Schedule Commands</td><td>3</td><td>Administrator</td></tr>
                        <tr><td>Results Commands</td><td>3</td><td>Administrator</td></tr>
                        <tr><td>Utility Commands</td><td>3</td><td>2 Admin + 1 Everyone</td></tr>
                        <tr><td><strong>Total</strong></td><td><strong>9</strong></td><td></td></tr>
                    </tbody>
                </table>
            </section>
        </div>
    </main>
</body>
</html>
