<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madden Highlights Bot - Documentation</title>
    <style>
        :root {
            --bg-primary: #0f1419;
            --bg-secondary: #1a1f2e;
            --bg-card: #1e2433;
            --text-primary: #e7e9ea;
            --text-secondary: #8b98a5;
            --accent-blue: #1d9bf0;
            --accent-green: #00ba7c;
            --border-color: #2f3542;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
        header { background: var(--bg-secondary); border-bottom: 1px solid var(--border-color); padding: 20px 0; position: sticky; top: 0; z-index: 100; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .back-link { color: var(--accent-blue); text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .bot-icon { width: 48px; height: 48px; background: linear-gradient(135deg, #ff7a00, #1d9bf0); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        main { padding: 40px 0; }
        .content-section { margin-bottom: 48px; }
        .content-section h2 { font-size: 1.75rem; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color); }
        .content-section h3 { font-size: 1.25rem; margin: 24px 0 12px; color: var(--accent-blue); }
        .content-section p { color: var(--text-secondary); margin-bottom: 16px; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 16px; }
        .card h4 { margin-bottom: 8px; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .feature-item { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 16px; }
        .feature-icon { font-size: 24px; margin-bottom: 8px; }
        .feature-item h4 { margin-bottom: 4px; }
        .feature-item p { color: var(--text-secondary); font-size: 0.9rem; margin: 0; }
        .command-table { width: 100%; border-collapse: collapse; margin-bottom: 24px; }
        .command-table th, .command-table td { text-align: left; padding: 12px 16px; border-bottom: 1px solid var(--border-color); }
        .command-table th { background: var(--bg-secondary); color: var(--text-secondary); font-weight: 600; font-size: 0.85rem; text-transform: uppercase; }
        .command-name { font-family: 'Consolas', monospace; background: var(--bg-secondary); padding: 4px 8px; border-radius: 4px; color: var(--accent-blue); }
        .code-block { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; padding: 16px; font-family: 'Consolas', monospace; font-size: 0.9rem; overflow-x: auto; margin-bottom: 16px; }
        .tag { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; margin-right: 6px; }
        .tag.user { background: rgba(0, 186, 124, 0.2); color: var(--accent-green); }
        .tag.admin { background: rgba(255, 122, 0, 0.2); color: #ff7a00; }
        ul { margin-left: 24px; margin-bottom: 16px; color: var(--text-secondary); }
        li { margin-bottom: 8px; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="back-link"><span>&larr;</span> Back to All Bots</a>
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="bot-icon">&#127944;</div>
                    <h1>Madden Highlights Bot</h1>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <section class="content-section">
                <h2>Overview</h2>
                <p>The Madden Highlights Bot automatically processes Madden franchise game VODs to detect scoring plays, generate highlight videos, and post individual clips to Discord. It uses PaddleOCR to read the in-game scoreboard, identifies touchdowns, field goals, and other scoring events, then creates a full highlight reel with original game audio and posts top clips for the community. A weekly roundup feature combines the best moments from each week's games into a single video with music. Highlights are uploaded to YouTube and clips are posted as YouTube Shorts, with a voting system for end-of-season awards.</p>

                <div class="feature-grid">
                    <div class="feature-item">
                        <div class="feature-icon">&#127909;</div>
                        <h4>Auto Highlight Videos</h4>
                        <p>Creates highlight reels from full game VODs with background music overlay</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128065;</div>
                        <h4>OCR Score Detection</h4>
                        <p>Reads Madden 26 scoreboard via PaddleOCR with 0/1 correction</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128293;</div>
                        <h4>Clip Voting</h4>
                        <p>Auto-reacts with fire emoji for community voting on best plays</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#9654;&#65039;</div>
                        <h4>YouTube Upload</h4>
                        <p>Uploads highlights to YouTube and clips as YouTube Shorts</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#127942;</div>
                        <h4>Season Polls</h4>
                        <p>End-of-season top 10 clips poll with reaction voting</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128279;</div>
                        <h4>Auto VOD Detection</h4>
                        <p>Detects YouTube/Twitch links in submissions channel</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#9203;</div>
                        <h4>Time Estimates</h4>
                        <p>Click the hourglass emoji to check processing progress and ETA</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128203;</div>
                        <h4>Admin Dashboard</h4>
                        <p>View processing queue, history, and manage games and clips</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#127925;</div>
                        <h4>Original Game Audio</h4>
                        <p>Highlight videos keep original game commentary; music reserved for weekly roundups</p>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">&#128197;</div>
                        <h4>Weekly Roundup</h4>
                        <p>Combines highlights from all games in a week into one video with music overlay</p>
                    </div>
                </div>
            </section>

            <section class="content-section">
                <h2>How It Works</h2>
                <div class="card">
                    <h4>Processing Pipeline</h4>
                    <p>When a VOD link is posted in the submissions channel:</p>
                    <ol style="margin-left: 24px; color: var(--text-secondary);">
                        <li>Bot reacts with &#9203; and adds the job to the processing queue</li>
                        <li>Downloads the VOD from YouTube/Twitch (or uses a local file)</li>
                        <li>Two-pass analysis: fast brightness scan to find gameplay, then PaddleOCR on scoreboard</li>
                        <li>Detects score changes with sanity checks (max 8 pts/play, 1&#8596;7 OCR correction)</li>
                        <li>Extracts individual clips around each scoring play (20-60 seconds each)</li>
                        <li>Creates a full highlight video with original game audio (no music)</li>
                        <li>Uploads highlight to YouTube and top clips as YouTube Shorts</li>
                        <li>Posts highlights and top clips (~1/3 of scoring events) to Discord channels with YouTube links</li>
                        <li>Reacts &#9989; when done (or &#10060; on failure)</li>
                    </ol>
                </div>

                <div class="card">
                    <h4>Job Queue System</h4>
                    <p>The bot supports parallel processing with a configurable queue. By default, it can process 2 VODs simultaneously with up to 10 more in the queue. Users can click the &#9203; emoji on their submission to see estimated time remaining and progress percentage.</p>
                </div>

                <div class="card">
                    <h4>Score Detection</h4>
                    <p>The analyzer uses a debounced scoring system &mdash; a score must appear consistently across 2+ consecutive frames to be accepted. It handles PaddleOCR's common "0" vs "1" misread (a score of exactly 1 is impossible in football) and "1" vs "7" digit confusion by trying all possible digit swaps and finding the most plausible score change (no more than 8 points per play, scores never decrease).</p>
                </div>
            </section>

            <section class="content-section">
                <h2>Commands</h2>

                <h3>Setup Commands <span class="tag admin">Admin Only</span></h3>
                <table class="command-table">
                    <thead><tr><th>Command</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><span class="command-name">!setchannel vod #channel</span></td><td>Set the VOD submissions channel where users post game links</td></tr>
                        <tr><td><span class="command-name">!setchannel highlights #channel</span></td><td>Set the channel where highlight videos are posted</td></tr>
                        <tr><td><span class="command-name">!setchannel clips #channel</span></td><td>Set the channel where individual clips are posted with voting</td></tr>
                    </tbody>
                </table>

                <h3>Admin Commands <span class="tag admin">Admin Only</span></h3>
                <table class="command-table">
                    <thead><tr><th>Command</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><span class="command-name">!dashboard</span></td><td>Admin dashboard &mdash; shows active jobs, queue, recent history, and all processed games</td></tr>
                        <tr><td><span class="command-name">!gameclips &lt;name&gt;</span></td><td>View all clips for a specific game with IDs and YouTube links</td></tr>
                        <tr><td><span class="command-name">!delete clip &lt;id&gt;</span></td><td>Delete a specific clip by ID (removes from Discord and database)</td></tr>
                        <tr><td><span class="command-name">!delete game &lt;name&gt;</span></td><td>Delete all clips for a game (requires confirmation)</td></tr>
                        <tr><td><span class="command-name">!weeklyroundup &lt;week&gt;</span></td><td>Create a weekly roundup video from all games in a week (e.g., <code>!weeklyroundup Week 1</code>)</td></tr>
                        <tr><td><span class="command-name">!seasonpoll [count]</span></td><td>Create end-of-season poll from top clips (default: top 10)</td></tr>
                    </tbody>
                </table>

                <h3>Info Commands <span class="tag user">Everyone</span></h3>
                <table class="command-table">
                    <thead><tr><th>Command</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><span class="command-name">!channels</span></td><td>Show the current channel configuration</td></tr>
                        <tr><td><span class="command-name">!status</span></td><td>Check what's currently being processed and queue status</td></tr>
                        <tr><td><span class="command-name">!topclips [count]</span></td><td>Show top clips ranked by fire reaction count (default: 10)</td></tr>
                        <tr><td><span class="command-name">!pollresults</span></td><td>Show current season poll standings</td></tr>
                    </tbody>
                </table>

                <h3>Interactive Features <span class="tag user">Everyone</span></h3>
                <table class="command-table">
                    <thead><tr><th>Action</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><span class="command-name">React &#9203; on a VOD message</span></td><td>See processing progress, elapsed time, and estimated time remaining (auto-deletes after 15s)</td></tr>
                        <tr><td><span class="command-name">React &#128293; on clips</span></td><td>Vote for your favorite clips &mdash; counts toward !topclips rankings</td></tr>
                    </tbody>
                </table>
            </section>

            <section class="content-section">
                <h2>Admin Dashboard</h2>
                <div class="card">
                    <h4>!dashboard</h4>
                    <p>The admin dashboard shows a complete overview of the bot's status:</p>
                    <ul>
                        <li><strong>Processing:</strong> Currently active jobs with elapsed time</li>
                        <li><strong>Queued:</strong> Pending jobs with queue position and wait time</li>
                        <li><strong>Recent History:</strong> Completed and failed jobs from the current session</li>
                        <li><strong>All Processed Games:</strong> Every game in the database with clip counts and dates</li>
                    </ul>
                    <p>From the dashboard, admins can use <code>!gameclips &lt;name&gt;</code> to drill into a specific game's clips, and <code>!delete</code> to remove individual clips or entire games.</p>
                </div>
            </section>

            <section class="content-section">
                <h2>Voting System</h2>
                <div class="card">
                    <h4>Clip Voting</h4>
                    <p>After processing a game, the bot selects the top ~1/3 of scoring events as individual clips, prioritizing touchdowns and turnovers over field goals. Each clip posted to the clips channel gets an automatic &#128293; reaction. Members react with &#128293; to vote for their favorite clips. Use <code>!topclips</code> to see the leaderboard at any time.</p>
                </div>
                <div class="card">
                    <h4>Season Poll</h4>
                    <p>At the end of a season, an admin runs <code>!seasonpoll</code> to create a numbered poll of the top 10 most-reacted clips. Members vote by reacting with number emojis (1&#65039;&#8419; through &#128287;). Check standings with <code>!pollresults</code>.</p>
                </div>
            </section>

            <section class="content-section">
                <h2>Weekly Roundup</h2>
                <div class="card">
                    <h4>!weeklyroundup &lt;week&gt;</h4>
                    <p>Creates a ~3.5 minute highlight video combining the best moments from every game in a given week. Each game gets proportional screen time based on its highlight video length.</p>
                    <ul>
                        <li><strong>Proportional segments:</strong> Longer games get more time in the roundup</li>
                        <li><strong>Music overlay:</strong> Game audio is muted and replaced with a randomly selected background track</li>
                        <li><strong>Auto-posted:</strong> The roundup video is posted to the highlights channel</li>
                        <li><strong>Database tracking:</strong> Each processed game's highlight video is automatically saved for roundup use</li>
                    </ul>
                </div>
            </section>

            <section class="content-section">
                <h2>Command Summary</h2>
                <div class="card">
                    <h4>Total Commands: 13</h4>
                    <p><strong>Admin:</strong> setchannel (3 types), dashboard, gameclips, delete (clip/game), weeklyroundup, seasonpoll</p>
                    <p><strong>Everyone:</strong> channels, status, topclips, pollresults</p>
                    <p><strong>Interactive:</strong> &#9203; reaction for time estimates, &#128293; reaction for clip voting</p>
                    <p><strong>Automatic:</strong> VOD link detection, parallel processing queue, YouTube upload, clip posting, weekly roundup</p>
                </div>
            </section>

            <section class="content-section">
                <h2>Setup & Configuration</h2>
                <h3>Installation</h3>
                <div class="code-block">
# Navigate to bot directory
cd MaddenHighlights

# Create virtual environment (Python 3.10 required for PaddleOCR)
python3.10 -m venv venv310

# Install dependencies
venv310\Scripts\pip install discord.py python-dotenv
venv310\Scripts\pip install paddlepaddle==2.6.2 paddleocr==2.9.1
venv310\Scripts\pip install opencv-python numpy Pillow yt-dlp
venv310\Scripts\pip install google-api-python-client google-auth-oauthlib

# Configure .env file
# DISCORD_BOT_TOKEN=your_token_here

# Run YouTube authorization (one-time)
venv310\Scripts\python youtube_auth.py

# Run the bot
venv310\Scripts\python bot.py
                </div>

                <h3>First-Time Setup</h3>
                <ol style="margin-left: 24px; color: var(--text-secondary);">
                    <li>Add your Discord bot token to the <code>.env</code> file</li>
                    <li>Set up YouTube OAuth credentials in Google Cloud Console</li>
                    <li>Run <code>venv310\Scripts\python youtube_auth.py</code> to authorize YouTube uploads</li>
                    <li>Run <code>venv310\Scripts\python bot.py</code> (or use <code>start_bot.bat</code>)</li>
                    <li>In Discord, use <code>!setchannel vod #vod-submissions</code></li>
                    <li>Use <code>!setchannel highlights #highlights</code></li>
                    <li>Use <code>!setchannel clips #clips</code></li>
                </ol>

                <h3>YouTube Setup</h3>
                <ol style="margin-left: 24px; color: var(--text-secondary);">
                    <li>Create a project in Google Cloud Console</li>
                    <li>Enable the YouTube Data API v3</li>
                    <li>Create OAuth 2.0 credentials (Desktop app type)</li>
                    <li>Download the JSON and save as <code>client_secret.json</code> in the MaddenHighlights folder</li>
                    <li>Add yourself as a test user in the OAuth consent screen</li>
                    <li>Run <code>youtube_auth.py</code> &mdash; approve in browser &mdash; token saved to <code>youtube_token.json</code></li>
                </ol>

                <h3>Configuration Files</h3>
                <table class="command-table">
                    <thead><tr><th>File</th><th>Purpose</th></tr></thead>
                    <tbody>
                        <tr><td><code>.env</code></td><td>Discord bot token</td></tr>
                        <tr><td><code>bot_config.py</code></td><td>Command prefix, upload size limit, queue size, processing time estimate</td></tr>
                        <tr><td><code>config.py</code></td><td>Video analysis settings (sample interval, clip durations, scoreboard regions, music settings)</td></tr>
                        <tr><td><code>client_secret.json</code></td><td>YouTube OAuth 2.0 credentials (from Google Cloud Console)</td></tr>
                        <tr><td><code>youtube_token.json</code></td><td>Saved YouTube authorization token (auto-generated)</td></tr>
                        <tr><td><code>data/clips.db</code></td><td>SQLite database for clips, settings, and polls</td></tr>
                        <tr><td><code>music/</code></td><td>MP3 files for background music on highlight videos (randomly selected)</td></tr>
                    </tbody>
                </table>
            </section>

            <section class="content-section">
                <h2>Architecture</h2>
                <div class="code-block">
MaddenHighlights/
&#9500;&#9472;&#9472; bot.py              # Discord bot entry point
&#9500;&#9472;&#9472; bot_config.py       # Bot settings (prefix, queue size, upload limits)
&#9500;&#9472;&#9472; bot_commands.py     # Admin commands Cog (dashboard, delete, polls)
&#9500;&#9472;&#9472; clip_database.py    # SQLite database layer
&#9500;&#9472;&#9472; job_queue.py        # Parallel processing job queue
&#9500;&#9472;&#9472; youtube_uploader.py # YouTube API upload (videos + Shorts)
&#9500;&#9472;&#9472; youtube_auth.py     # One-time YouTube OAuth authorization
&#9500;&#9472;&#9472; main.py             # Processing pipeline (download &#8594; analyze &#8594; clip)
&#9500;&#9472;&#9472; config.py           # Analysis & clip extraction settings
&#9500;&#9472;&#9472; start_bot.bat       # Windows launcher script
&#9500;&#9472;&#9472; .env                # Bot token
&#9500;&#9472;&#9472; src/
&#9474;   &#9500;&#9472;&#9472; analyzer.py     # OCR-based score detection engine
&#9474;   &#9500;&#9472;&#9472; clipper.py      # FFmpeg clip extraction, highlight stitching, music overlay
&#9474;   &#9500;&#9472;&#9472; detector.py     # Frame analysis & scoreboard OCR
&#9474;   &#9492;&#9472;&#9472; downloader.py   # YouTube/Twitch VOD downloader (yt-dlp)
&#9500;&#9472;&#9472; music/              # Background music MP3s for highlights
&#9500;&#9472;&#9472; downloads/          # Downloaded VODs
&#9500;&#9472;&#9472; clips/              # Extracted clips per game
&#9492;&#9472;&#9472; highlights/         # Full highlight videos
                </div>
            </section>

            <section class="content-section">
                <h2>YouTube Integration</h2>
                <p>The bot uploads all highlights and clips to YouTube using the YouTube Data API v3 with OAuth 2.0 authentication.</p>
                <div class="card">
                    <h4>How it works</h4>
                    <ul>
                        <li><strong>Highlight videos</strong> are uploaded as regular YouTube videos with scoring play descriptions</li>
                        <li><strong>Individual clips</strong> are uploaded as YouTube Shorts with #Shorts tag</li>
                        <li>YouTube links are included in Discord messages alongside the clip files</li>
                        <li>If YouTube upload fails, clips are still posted directly to Discord (under 8 MB)</li>
                        <li>The OAuth token auto-refreshes &mdash; you only need to authorize once</li>
                    </ul>
                </div>
            </section>
        </div>
    </main>
</body>
</html>
